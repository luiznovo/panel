# G-Panel Enterprise Deployment Guide

## üìã √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Instala√ß√£o R√°pida](#instala√ß√£o-r√°pida)
- [Configura√ß√£o Detalhada](#configura√ß√£o-detalhada)
- [Deploy com Docker](#deploy-com-docker)
- [Configura√ß√£o do Nginx](#configura√ß√£o-do-nginx)
- [Backup e Rollback](#backup-e-rollback)
- [Monitoramento](#monitoramento)
- [Troubleshooting](#troubleshooting)
- [Manuten√ß√£o](#manuten√ß√£o)

## üöÄ Vis√£o Geral

Este guia fornece instru√ß√µes completas para deploy do G-Panel em ambiente de produ√ß√£o com recursos enterprise:

- ‚úÖ **Docker** com multi-stage build otimizado
- ‚úÖ **PM2** para gerenciamento de processos
- ‚úÖ **Nginx** como proxy reverso e load balancer
- ‚úÖ **Backup autom√°tico** com rota√ß√£o inteligente
- ‚úÖ **Rollback** r√°pido e seguro
- ‚úÖ **Zero downtime** deployment
- ‚úÖ **SSL/TLS** com Let's Encrypt
- ‚úÖ **Monitoramento** e alertas
- ‚úÖ **Rate limiting** e seguran√ßa

## üìã Pr√©-requisitos

### Sistema Operacional
- Ubuntu 20.04+ / CentOS 8+ / Debian 11+
- M√≠nimo 2GB RAM, 20GB disco
- Acesso root ou sudo

### Software Necess√°rio
```bash
# Node.js 18+
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# PM2
sudo npm install -g pm2

# Nginx
sudo apt update
sudo apt install -y nginx

# Utilit√°rios
sudo apt install -y git curl wget unzip jq sqlite3
```

## ‚ö° Instala√ß√£o R√°pida

### 1. Clone e Configure
```bash
# Clone o reposit√≥rio
git clone https://github.com/seu-usuario/g-panel.git
cd g-panel

# Torne os scripts execut√°veis
chmod +x scripts/*.sh

# Execute o setup completo
sudo ./scripts/setup.sh
```

### 2. Configura√ß√£o Inicial
```bash
# Copie e configure as vari√°veis de ambiente
cp .env.example .env
nano .env

# Configure pelo menos estas vari√°veis obrigat√≥rias:
# JWT_SECRET=sua-chave-jwt-super-secreta
# SESSION_SECRET=sua-chave-sessao-super-secreta
# APP_URL=https://seu-dominio.com
```

### 3. Inicializa√ß√£o
```bash
# Executar seed e criar usu√°rio admin
npm run seed
npm run createUser

# Iniciar com PM2
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

## üîß Configura√ß√£o Detalhada

### Estrutura de Diret√≥rios
```
/opt/g-panel/
‚îú‚îÄ‚îÄ app/                 # C√≥digo da aplica√ß√£o
‚îú‚îÄ‚îÄ data/               # Banco de dados SQLite
‚îú‚îÄ‚îÄ logs/               # Logs da aplica√ß√£o
‚îú‚îÄ‚îÄ backups/            # Backups autom√°ticos
‚îú‚îÄ‚îÄ nginx/              # Configura√ß√µes do Nginx
‚îú‚îÄ‚îÄ scripts/            # Scripts de deploy
‚îî‚îÄ‚îÄ uploads/            # Arquivos enviados
```

### Configura√ß√£o do Usu√°rio
```bash
# Criar usu√°rio dedicado
sudo useradd -m -s /bin/bash g-panel
sudo usermod -aG docker g-panel

# Configurar diret√≥rios
sudo mkdir -p /opt/g-panel/{app,data,logs,backups,nginx,uploads}
sudo chown -R g-panel:g-panel /opt/g-panel
```

### Vari√°veis de Ambiente
Edite o arquivo `.env` com suas configura√ß√µes:

```bash
# Configura√ß√µes b√°sicas
NODE_ENV=production
PORT=3000
APP_URL=https://seu-dominio.com

# Seguran√ßa (OBRIGAT√ìRIO alterar)
JWT_SECRET=gere-uma-chave-super-secreta-aqui
SESSION_SECRET=gere-outra-chave-super-secreta-aqui

# Banco de dados
DB_TYPE=sqlite
DB_PATH=./data/database.sqlite

# Email (configure conforme seu provedor)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=seu-email@gmail.com
SMTP_PASS=sua-senha-de-app
```

## üê≥ Deploy com Docker

### Build da Imagem
```bash
# Build da imagem otimizada
docker build -t g-panel:latest .

# Ou usar docker-compose
docker-compose -f docker-compose.prod.yml build
```

### Execu√ß√£o com Docker Compose
```bash
# Iniciar todos os servi√ßos
docker-compose -f docker-compose.prod.yml up -d

# Verificar status
docker-compose -f docker-compose.prod.yml ps

# Ver logs
docker-compose -f docker-compose.prod.yml logs -f g-panel
```

### Configura√ß√£o de Volumes
```yaml
# docker-compose.prod.yml
volumes:
  - ./data:/app/data
  - ./uploads:/app/uploads
  - ./logs:/app/logs
  - ./backups:/opt/g-panel/backups
```

## üåê Configura√ß√£o do Nginx

### Instala√ß√£o da Configura√ß√£o
```bash
# Copiar configura√ß√£o
sudo cp nginx/g-panel.conf /etc/nginx/sites-available/
sudo cp nginx/snippets/g-panel-common.conf /etc/nginx/snippets/

# Ativar site
sudo ln -s /etc/nginx/sites-available/g-panel.conf /etc/nginx/sites-enabled/

# Remover site padr√£o
sudo rm -f /etc/nginx/sites-enabled/default

# Testar configura√ß√£o
sudo nginx -t

# Reiniciar Nginx
sudo systemctl restart nginx
```

### Configura√ß√£o SSL com Let's Encrypt
```bash
# Instalar Certbot
sudo apt install -y certbot python3-certbot-nginx

# Obter certificado
sudo certbot --nginx -d seu-dominio.com -d www.seu-dominio.com

# Renova√ß√£o autom√°tica
sudo crontab -e
# Adicionar: 0 12 * * * /usr/bin/certbot renew --quiet
```

### Load Balancing
Para m√∫ltiplas inst√¢ncias, edite `/etc/nginx/sites-available/g-panel.conf`:

```nginx
upstream g_panel_backend {
    server 127.0.0.1:3000 weight=3;
    server 127.0.0.1:3001 weight=2;
    server 127.0.0.1:3002 weight=1 backup;
    
    least_conn;
    keepalive 32;
}
```

## üíæ Backup e Rollback

### Backup Autom√°tico
```bash
# Configurar backup di√°rio
sudo crontab -e
# Adicionar: 0 2 * * * /opt/g-panel/scripts/backup.sh create

# Backup manual
./scripts/backup.sh create

# Listar backups
./scripts/backup.sh list

# Verificar backup
./scripts/backup.sh verify nome-do-backup.tar.gz
```

### Rollback
```bash
# Rollback interativo
./scripts/rollback.sh

# Rollback autom√°tico para backup espec√≠fico
./scripts/rollback.sh auto daily_20231201_120000_abc123

# Rollback para o backup mais recente
./scripts/rollback.sh auto latest
```

### Estrat√©gia de Backup
- **Di√°rios**: Mantidos por 7 dias
- **Semanais**: Mantidos por 4 semanas
- **Mensais**: Mantidos por 12 meses
- **Deploy**: Backup antes de cada atualiza√ß√£o

## üöÄ Deploy Autom√°tico

### Deploy com Zero Downtime
```bash
# Deploy completo
./scripts/deploy.sh

# Deploy apenas do c√≥digo
./scripts/deploy.sh --code-only

# Deploy com skip de testes
./scripts/deploy.sh --skip-tests
```

### Pipeline CI/CD
Exemplo para GitHub Actions:

```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Deploy to server
        uses: appleboy/ssh-action@v0.1.5
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            cd /opt/g-panel
            git pull origin main
            ./scripts/deploy.sh
```

## üìä Monitoramento

### PM2 Monitoring
```bash
# Status dos processos
pm2 status

# Logs em tempo real
pm2 logs g-panel

# M√©tricas
pm2 monit

# Restart autom√°tico em caso de falha
pm2 start ecosystem.config.js --watch
```

### Health Checks
```bash
# Verificar sa√∫de da aplica√ß√£o
curl http://localhost:3000/health

# Verificar Nginx
curl http://localhost/nginx-health

# Verificar SSL
ssl-cert-check -c /etc/letsencrypt/live/seu-dominio.com/cert.pem
```

### Logs
```bash
# Logs da aplica√ß√£o
tail -f /opt/g-panel/logs/app.log

# Logs do Nginx
tail -f /var/log/nginx/g-panel-access.log
tail -f /var/log/nginx/g-panel-error.log

# Logs do PM2
pm2 logs g-panel --lines 100
```

## üîß Troubleshooting

### Problemas Comuns

#### Aplica√ß√£o n√£o inicia
```bash
# Verificar logs
pm2 logs g-panel

# Verificar configura√ß√£o
node -c app.js

# Verificar depend√™ncias
npm audit
```

#### Nginx retorna 502
```bash
# Verificar se aplica√ß√£o est√° rodando
curl http://localhost:3000

# Verificar configura√ß√£o do Nginx
sudo nginx -t

# Verificar logs do Nginx
tail -f /var/log/nginx/error.log
```

#### Banco de dados corrompido
```bash
# Verificar integridade
sqlite3 /opt/g-panel/data/database.sqlite "PRAGMA integrity_check;"

# Restaurar do backup
./scripts/rollback.sh auto latest
```

#### SSL n√£o funciona
```bash
# Verificar certificado
sudo certbot certificates

# Renovar certificado
sudo certbot renew

# Verificar configura√ß√£o SSL
ssl-cert-check -c /etc/letsencrypt/live/seu-dominio.com/cert.pem
```

### Comandos de Diagn√≥stico
```bash
# Status geral do sistema
./scripts/status.sh

# Verificar portas
sudo netstat -tlnp | grep :3000
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :443

# Verificar processos
ps aux | grep node
ps aux | grep nginx

# Verificar espa√ßo em disco
df -h
du -sh /opt/g-panel/*
```

## üõ†Ô∏è Manuten√ß√£o

### Atualiza√ß√µes
```bash
# Atualizar sistema
sudo apt update && sudo apt upgrade -y

# Atualizar Node.js
sudo npm install -g n
sudo n stable

# Atualizar PM2
sudo npm install -g pm2@latest
pm2 update

# Atualizar depend√™ncias do projeto
npm update
```

### Limpeza
```bash
# Limpar logs antigos
find /opt/g-panel/logs -name "*.log" -mtime +30 -delete

# Limpar backups antigos
./scripts/backup.sh cleanup

# Limpar cache do Docker
docker system prune -a

# Limpar cache do npm
npm cache clean --force
```

### Otimiza√ß√£o
```bash
# Otimizar banco de dados
sqlite3 /opt/g-panel/data/database.sqlite "VACUUM;"

# Otimizar imagens Docker
docker image prune -a

# Configurar swap (se necess√°rio)
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

### Seguran√ßa
```bash
# Atualizar certificados SSL
sudo certbot renew

# Verificar permiss√µes
sudo find /opt/g-panel -type f -perm /o+w

# Configurar firewall
sudo ufw enable
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443

# Verificar logs de seguran√ßa
sudo tail -f /var/log/auth.log
```

## üìû Suporte

### Contatos
- **Email**: suporte@g-panel.com
- **Discord**: [G-Panel Community](https://discord.gg/g-panel)
- **GitHub**: [Issues](https://github.com/seu-usuario/g-panel/issues)

### Recursos Adicionais
- [Documenta√ß√£o da API](https://docs.g-panel.com)
- [Guia de Desenvolvimento](./DEVELOPMENT.md)
- [Changelog](./CHANGELOG.md)
- [FAQ](https://docs.g-panel.com/faq)

---

**¬© 2024 G-Panel. Todos os direitos reservados.**

> üí° **Dica**: Mantenha sempre backups atualizados e teste o processo de rollback regularmente em ambiente de desenvolvimento.